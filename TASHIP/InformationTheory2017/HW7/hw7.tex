% From here  https://raw.githubusercontent.com/jgm/pandoc-templates/master/default.beamer
\documentclass[]{article}
\usepackage{mathtools,amsmath,amssymb,amsthm,mathrsfs}
\usepackage{commath}
\usepackage{lmodern}
\usepackage[sc,osf]{mathpazo}
%\usepackage{circuitikz}
\makeatletter
\@ifpackageloaded{tex4ht}{
    \def\pgfsysdriver{pgfsys-tex4ht.def}
}
\makeatother
\usepackage{pgfplots}
\usepackage{pgfplotstable}
\usepackage[multidot]{grffile}

%% Include newcommands.
\IfFileExists{tex_newcommands.tex}{
    \input{tex_newcommands.tex}
}

\IfFileExists{dot2texi.sty}{
    \usepackage{dot2texi}
}{ }

\usepackage{pgf,tikz}
\usetikzlibrary{shapes,backgrounds,positioning,matrix,decorations}

\providecommand{\tightlist}{%
\setlength{\itemsep}{0pt}\setlength{\parskip}{0pt}}

\usepackage{siunitx}
\usepackage{ifxetex,ifluatex}
\usepackage{listings}
\lstset{ 
    basicstyle=\ttfamily,
    numbers=left,
    numberstyle=\footnotesize,
    stepnumber=2,
    keywordstyle=\color[rgb]{0.13,0.29,0.53}\bfseries,
    stringstyle=\color[rgb]{0.31,0.60,0.02},
    commentstyle=\color[rgb]{0.56,0.35,0.01}\itshape,
    numbersep=5pt,
    backgroundcolor=\color{black!10},
    tabsize=2,
    breaklines=true,
    linewidth=\textwidth
}
% \usepackage[xindyo,acronym,nomain,toc]{glossaries}
% \makeglossaries
%\usepackage[xindy]{imakeidx}
%\makeindex
\setlength{\parskip}{3mm}
\newtheorem{axiom}{Axiom}
\newtheorem{definition}{Definition}
%\newtheorem{comment}{Comment}
\newtheorem{example}{Example}
\newtheorem{lemma}{Lemma}
\newtheorem{corollary}{Corollary}
\newtheorem{property}{Property}
\newtheorem{problem}{Problem}
\newtheorem{remark}{Remark}
\newtheorem{theorem}{Theorem}
\newtheorem{script}{Script}
\usepackage{fixltx2e} % provides \textsubscript
% use upquote if available, for straight quotes in verbatim environments
\IfFileExists{upquote.sty}{\usepackage{upquote}}{}
\ifnum 0\ifxetex 1\fi\ifluatex 1\fi=0 % if pdftex
  \usepackage[utf8]{inputenc}
\else % if luatex or xelatex
  \ifxetex
    \usepackage{mathspec}
    \usepackage{xltxtra,xunicode}
  \else
    \usepackage{fontspec}
  \fi
  \defaultfontfeatures{Mapping=tex-text,Scale=MatchLowercase}
  \newcommand{\euro}{â‚¬}
\fi
% use microtype if available
\IfFileExists{microtype.sty}{\usepackage{microtype}}{}
\usepackage[right=5cm, marginparwidth=4cm]{geometry}
\usepackage{graphicx}
% Redefine \includegraphics so that, unless explicit options are
% given, the image width will not exceed the width of the page.
% Images get their normal width if they fit onto the page, but
% are scaled down if they would overflow the margins.
\makeatletter
\def\ScaleIfNeeded{%
  \ifdim\Gin@nat@width>\linewidth
    \linewidth
  \else
    \Gin@nat@width
  \fi
}
\makeatother
\let\Oldincludegraphics\includegraphics
{%
 \catcode`\@=11\relax%
 \gdef\includegraphics{\@ifnextchar[{\Oldincludegraphics}{\Oldincludegraphics[width=\ScaleIfNeeded]}}%
}%
\ifxetex
  \usepackage[setpagesize=false, % page size defined by xetex
              unicode=false, % unicode breaks when used with xetex
              xetex]{hyperref}
\else
  \usepackage[unicode=true]{hyperref}
\fi
\hypersetup{breaklinks=true,
            bookmarks=true,
            pdfauthor={Dilawar Singh},
            pdftitle={Homework 7},
            colorlinks=true,
            citecolor=blue,
            urlcolor=blue,
            linkcolor=magenta,
            pdfborder={0 0 0}}
\urlstyle{same}  % don't use monospace font for urls
\setlength{\parindent}{0pt}
\setlength{\parskip}{6pt plus 2pt minus 1pt}
\setlength{\emergencystretch}{3em}  % prevent overfull lines
\setcounter{secnumdepth}{5}

\title{Homework 7}
\author{Dilawar Singh}
\date{\today}
\usepackage{pgfplots}
\usepackage{libertine,mathpazo}
\makeatletter
\@ifpackageloaded{subfig}{}{\usepackage{subfig}}
\@ifpackageloaded{caption}{}{\usepackage{caption}}
\captionsetup[subfloat]{margin=0.5em}
\AtBeginDocument{%
\renewcommand*\figurename{Figure}
\renewcommand*\tablename{Table}
}
\AtBeginDocument{%
\renewcommand*\listfigurename{List of Figures}
\renewcommand*\listtablename{List of Tables}
}
\@ifpackageloaded{float}{}{\usepackage{float}}
\floatstyle{ruled}
\@ifundefined{c@chapter}{\newfloat{codelisting}{h}{lop}}{\newfloat{codelisting}{h}{lop}[chapter]}
\floatname{codelisting}{Listing}
\newcommand*\listoflistings{\listof{codelisting}{List of Listings}}
\makeatother

\begin{document}
\maketitle

\section{Large deviation theory.}\label{large-deviation-theory.}

We roll a fair six sided die \(n\) times, where \(n\) is large. What is
the probability that the number of 2s is at least double the number of
1s in the resulting string? Of strings which satisfy this condition,
what proportion of values will be 1s?

We can split this calculation into the following parts:

\begin{enumerate}
\def\labelenumi{\alph{enumi}.}
\item
  What is the constraint equation for the set \(E\) of types (or
  empirical distributions) \(P_x^n\) which satisfy the required
  condition?
\item
  Let \(Q\) be the uniform distribution. Show that the member \(P^*\) of
  E which minimizes the relative entropy \(D(P^*||Q)\) is the maximum
  entropy distribution subject to the constraints from (a).
\item
  Find the distribution \(P^*\). E.g. let the proportion of 1s be an
  unknown \(x\). Use some intuition to set the rest of the distribution.
  Then use calculus to minimize. You can find the answer analytically.
\item
  What is the probability that the outcome of \(n\) die rolls belongs to
  \(P^*\) (and therefore, to \(E\) first order in the exponent)?
\item
  (Optional) Verify your answer for n = 250 by Monte Carlo simulation.
\end{enumerate}

\subsection{Solution}\label{solution}

Let's do the simulation first, just to feel the problem. We vary the
value of \(n\) and compute the probability of these `rare events' after
recording 100 such events.

\begin{tikzpicture}[scale=1 , every node/.style={} ]
    \begin{tikzpicture}[scale=1]
        \begin{semilogyaxis}[ xlabel=n,ylabel=p ]
        \addplot+ [color=blue] gnuplot [ raw gnuplot ] {
            plot "./results.txt" using (column("n")):(100/column("N")) with p;
        };
        \end{semilogyaxis}
    \end{tikzpicture}
\end{tikzpicture}\begin{tikzpicture}[scale=1 , every node/.style={} ]
    \begin{tikzpicture}[scale=1]
        \begin{axis}[ xlabel=n,ylabel={Number of 1s} ]
        \addplot+ [color=blue] gnuplot [ raw gnuplot ] {
            plot "./results.txt" using (column("n")):(column("n1")) with p;
        };
        \end{axis}
    \end{tikzpicture}
\end{tikzpicture}

The probability of rare events decreases logarithmically with \(n\).

\subsubsection{Part a}\label{part-a}

The empirical distribution must have \(\Pr(2) \ge \Pr(1)\). Or,

\begin{equation} 
\begin{aligned}
p_1 + p_2 + p_3 + p_4 + p_5 + p_6 &= 1 \\
p_2 & \ge 2 p_1 
\end{aligned}
\label{eq:eq1}\end{equation}

\subsubsection{Part b}\label{part-b}

\begin{equation}D(P||Q) = \sum_i p_i \log\left( \frac{1}{6p_i} \right)\label{eq:eq2}\end{equation}

Find \(P\) which minimizes \(D(P||Q)\) subject to eq.~\ref{eq:eq1}. We
use Langrange multipliers. See the Wiki article for more details.

\[L(p1,p2,\ldots,p_6,\lambda_1,\lambda_2) = D(P||Q) + \lambda_1(p_2-p_1) + 
\lambda_2(p_1+p_2+\ldots+p_6)\]

We differentiate \(L\) with respect to
\(p_1,p_2,\ldots,p_6,\lambda_1,\lambda_2\) and set to 0. We get the
following equations.

\[
\begin{aligned}
1 + \log( 6p_1 ) - 2 \lambda_1 + \lambda_2 &= 0 \\
1 + \log( 6p_2 ) - \lambda_1 + \lambda_2 &= 0 \\
1 + \log( 6p_3 ) - 0 + \lambda_2 &= 0 \\
1 + \log( 6p_4 ) - 0 + \lambda_2 &= 0 \\
\vdots \\
1 + \log( 6p_6 ) - 0 + \lambda_2 &= 0 \\
p_2 &= 2 p_1 \\
p_1 + p_2 + \dots + p+6 &= 1 
\end{aligned}
\]

These leads to following (I am not wrong).
\(\frac{p_2}{p_3} = 2^{1/3}\), \(p_2=2p_1\) and \(p_3=p_4=p_5=p_6\).

\(p_1=\frac{1}{3 + 4^{4/3}}, p_2=2p_1,p_3=p_4=p_5=p_6=\frac{2^{2/3}}{3+4^{4/3}}\).
According to these calculation distribution \(H(E)=2.557196\) bits
\_which is very close to numerical results we have in
fig.~\ref{fig:hvsd_}. Note that we have only shown that this minimizes
\(E\). \marginpar{It is not hard to show this also maximizes
$H$}

The simulation shows (fig.~\ref{fig:hvsd}) for a distribution \(E\)
which satisfies the condition above, \(D(E||Q)\) decreases with
\(H(E)\). Now we need a proof of this.

\begin{figure}
\centering
\includegraphics{./problem2.pdf}
\caption{KL divergence Vs Entropy}\label{fig:hvsd}
\end{figure}

\subsubsection{Part c}\label{part-c}

Assuming the \(\Pr(1)=x\) then the \(\Pr(2)=2x\) and
\(\Pr(3)=\Pr(4)=\Pr(5)=\Pr(6)=\frac{1-3x}{4}\).

\begin{tikzpicture}[scale=1]
    \begin{axis}[ xlabel={$x=\Pr(1)$},ylabel=H(E) bits, grid, ymax=3 ]
    \addplot [color=blue] gnuplot [ raw gnuplot ] {
        H(x) = - x * log(x) / log(2) - 2*x * log(2*x)/log(2) 
            - 4* (1-3*x)/4 * log((1-3*x)/4)/log(2);
        plot [x=0.001:0.3] H(x);
    };
    \end{axis}
\end{tikzpicture}

\subsubsection{Part d}\label{part-d}

See theorem 11.1.2 in book for details (chapter 11, Information theory
and statistics).

We compute the probability of each type which satisties the given
condition and then we add them up. This probability is given by
\(2^{-n(H(P^*)+D(P^*||Q))}\) where \(Q\) is uniform distribution.

Numerically its not possible to enumerate all types which statisfy the
constraints. So we do a random sampling (not-perfect here) and see if we
are getting close to the real value.

\begin{tikzpicture}[scale=1]
    \begin{axis}[
    xlabel=N,ylabel=Prob
    , grid style={draw=gray!20}, grid = both, minor tick num = 4 
    ]
    \addplot [color=blue] gnuplot [ raw gnuplot ] {
        plot "./probd.txt" using 1:2 every 10 with lines
    };
    \end{axis}
\end{tikzpicture}

This value should converge to \(4.937\times10^{-81}\). There is simply
no way I can do this numerically. Indeed, on desktop computer, I could
not generate a rare event in last 4 days for n = 250.

\end{document}
